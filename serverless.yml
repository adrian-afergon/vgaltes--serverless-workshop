service: gettogether

custom:
  defaultRegion: eu-west-1
  defaultStage: dev${env:SLSUSER, ""}
  getTogethersTableName: ${self:provider.stage}-gettogethers

provider:
    name: aws
    runtime: nodejs12.x
    region: ${opt:region, self:custom.defaultRegion}
    stage: ${opt:stage, self:custom.defaultStage}

plugins:
    - serverless-iam-roles-per-function

functions:
    getGetTogethers:
        handler: src/functions/getGetTogethers.handler
        events:
            - http:
                  path: api/getTogethers
                  method: get
        iamRoleStatements:
            - Effect: Allow
              Action: dynamodb:scan
              Resource: !GetAtt GetTogethersTable.Arn
        environment:
            getTogethersTableName: ${self:custom.getTogethersTableName}

resources:
    Resources:
        GetTogethersTable:
            Type: AWS::DynamoDB::Table
            Properties:
                TableName: ${self:custom.getTogethersTableName}
                AttributeDefinitions:
                    - AttributeName: id
                      AttributeType: N
                KeySchema:
                    - AttributeName: id
                      KeyType: HASH
                BillingMode: PAY_PER_REQUEST
